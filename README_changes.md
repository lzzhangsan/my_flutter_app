# 文件夹与文档放置防重叠功能实现

## 功能概述

为了提升用户体验，为应用添加了"防重叠"功能，确保在自由定位模式下，文件夹和文档不会相互重叠。此功能可以自动计算并调整拖拽后的项目位置，使其不与现有项目重叠。

## 主要特性

1. **智能位置检测**：
   - 自动检测当前视图中所有项目的位置
   - 基于网格坐标系计算最佳放置位置

2. **最近可用位置查找**：
   - 当用户拖拽项目到一个已被占用的位置时，自动寻找最近的可用位置
   - 使用螺旋搜索算法，从近到远搜索可用位置

3. **位置保留拖拽**：
   - 从文件夹拖拽项目到根目录时，保留拖拽的位置（避免重置到默认位置）
   - 确保拖拽位置也符合不重叠原则

4. **新项目智能放置**：
   - 为新创建的文件夹和文档自动计算最佳的放置位置
   - 优先占用左上角区域的空位

## 技术实现

核心功能由以下几个方法实现：

1. `_findNearestAvailablePosition`：
   - 检查目标位置是否被占用
   - 如被占用，以螺旋方式搜索最近的可用位置
   - 支持传入要排除的项目（例如当前正在移动的项目）

2. `_calculateEndPosition`：
   - 基于拖拽结束偏移量计算网格上的结束位置
   - 确保位置在屏幕范围内

3. `_calculateDefaultPosition`：
   - 为新创建的项目计算一个合适的默认位置
   - 按照从左到右、从上到下的顺序查找第一个可用位置

4. 改进的移动方法：
   - `_moveItemToRootWithPosition`
   - `_moveDocumentToDirectory`
   - `_moveFolderToDirectory`
   - `_processFreePositioning`

所有这些方法都经过增强，支持防重叠的位置计算。

## 用户交互与反馈

- 当项目被成功放置到新位置时，会显示即时的反馈消息
- 消息内容根据项目类型（文件夹/文档）和当前位置（根目录/子文件夹）而有所不同
- 在位置调整或移动失败时提供明确的错误提示

## 后续优化方向

1. 进一步优化防重叠算法，提高计算效率
2. 加入更高级的碰撞检测，考虑项目的实际大小
3. 增加用户自定义排列功能，允许用户设定首选排列方式
4. 改进视觉反馈，在拖拽过程中就提示可能的放置位置 